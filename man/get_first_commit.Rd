% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/get_first_commit.R
\name{get_first_commit}
\alias{get_first_commit}
\title{Find the first commit that introduces a function definition in a GitHub repo}
\usage{
get_first_commit(
  owner,
  repo,
  function_name,
  date_only = FALSE,
  pattern = NULL,
  branch = NULL,
  max_commits = Inf,
  cache_dir = getOption("ggext.git_cache", file.path(tempdir(), "gh_repo_cache"))
)
}
\arguments{
\item{owner}{Character scalar. GitHub username/organization.}

\item{repo}{Character scalar. GitHub repository name.}

\item{function_name}{Character scalar. Symbol to search for (e.g. \code{"geom_foo"}).}

\item{date_only}{Logical; if \code{TRUE}, return only the \code{Date} of the first
verified defining commit. Defaults to \code{FALSE}.}

\item{pattern}{Optional character regex intended for verification. If \code{NULL},
defaults to a PCRE pattern approximating an assignment to \code{function_name}.
Note: this argument is currently not used by the implementation (verification
is done via \verb{git grep -E} with an internally constructed ERE).}

\item{branch}{Optional character scalar. Ref to check out before searching.
If \code{NULL}/empty, the function uses \code{origin/HEAD} when available, otherwise \code{HEAD}.}

\item{max_commits}{Maximum number of candidate commits to verify (in order).
Use to cap runtime on very large histories. Defaults to \code{Inf} (no cap).}

\item{cache_dir}{Directory used to cache cloned repositories. Defaults to
\code{getOption("ggext.git_cache", file.path(tempdir(), "gh_repo_cache"))}.}
}
\value{
If a defining commit is found:
\itemize{
\item If \code{date_only = TRUE}, a \code{Date}.
\item Otherwise, a one-row \code{data.frame} with columns:
\code{package}, \code{fname}, \code{first_commit}, \code{author}, \code{message}, \code{url}, \code{file}.
}
If not found (or if the repo cannot be searched), returns \code{NA} when
\code{date_only = TRUE}, otherwise \code{NULL}.
}
\description{
Clones (or refreshes) a GitHub repository into a local cache directory, checks
out a target ref (branch or default), then scans commits (oldest to newest)
that \emph{touch} occurrences of \code{function_name} under \verb{R/}. For each candidate
commit, it verifies the function is actually defined (assigned via \verb{<-} or
\code{=}) somewhere in the tree at that commit using \verb{git grep}.
}
\details{
The return value is either the commit date (when \code{date_only = TRUE}) or a
one-row \code{data.frame} with commit metadata and a GitHub URL.

This function emits diagnostic \code{message()} output when it cannot determine an
answer (e.g., repository not found/inaccessible, checkout failed, git log/grep
errors) or when the symbol is never defined under \verb{R/}.

Candidate commits are obtained with:
\itemize{
\item \verb{git log --reverse -S <function_name> <ref> -- R}
}
which searches for commits where the literal string \code{function_name} appears in
diffs under \verb{R/} (additions or removals). Each candidate is then validated by
searching the repository \emph{tree} at that commit with \verb{git grep} for an
assignment-like pattern such as \verb{foo <-} or \verb{foo =}.

If the local cached clone is corrupted or fetch fails, the cache directory for
that repo is deleted and recloned.

For best performance across sessions, set a persistent cache location:
\preformatted{
options(ggext.git_cache = "~/Library/Caches/ggext_git")
}
}
\examples{
\dontrun{
# Return full metadata for first defining commit of "geom_ridgeline"
x <- get_first_commit("wilkelab", "ggridges", "geom_ridgeline")

# Date only
d <- get_first_commit("tidyverse", "ggplot2", "geom_point", date_only = TRUE)

# Limit verification work
x2 <- get_first_commit("someorg", "somerepo", "foo", max_commits = 200)
}

}
\seealso{
\code{\link[processx:run]{processx::run}}
}
