% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/get_first_call_github.R
\name{get_first_call_github}
\alias{get_first_call_github}
\title{Find the first commit where a function is called in a GitHub repo}
\usage{
get_first_call_github(
  github_user,
  github_repo,
  fname = "ggplot",
  date_only = FALSE,
  branch = NULL,
  max_commits = Inf,
  cache_dir = getOption("ggext.git_cache", file.path(tempdir(), "gh_repo_cache")),
  dir = "R"
)
}
\arguments{
\item{github_user}{Character scalar. GitHub username or organization.}

\item{fname}{Character scalar. Symbol to search for (e.g. \code{"ggplot"}).}

\item{date_only}{Logical; if \code{TRUE}, return only the \code{Date} of the first
verified call commit. Defaults to \code{FALSE}.}

\item{branch}{Optional character scalar. Ref to check out before searching.
If \code{NULL} or empty, the function uses \code{origin/HEAD} when available,
otherwise \code{HEAD}.}

\item{max_commits}{Maximum number of candidate commits to verify (in order).
Use to cap runtime on very large histories. Defaults to \code{Inf} (no cap).}

\item{cache_dir}{Directory used to cache cloned repositories. Defaults to
\code{getOption("ggext.git_cache", file.path(tempdir(), "gh_repo_cache"))}.}

\item{dir}{Directory within the repo to search. Defaults to \code{"R"}.}

\item{repo}{Character scalar. GitHub repository name.}
}
\value{
If a call is found:
\itemize{
\item If \code{date_only = TRUE}, a \code{Date}.
\item Otherwise, a one-row \code{data.frame} with columns:
\code{github_user}, \code{repo}, \code{fname}, \code{first_call}, \code{author}, \code{message}, \code{url}, \code{file}.
}
If not found (or if the repository cannot be searched), returns \code{NA} when
\code{date_only = TRUE}, otherwise \code{NULL}.
}
\description{
Clones a GitHub repository into a local cache directory (if not already
present), checks out a target ref (branch or default), then scans commits
(oldest to newest) whose diffs under \code{dir} match a call-like pattern for
\code{fname} (e.g. \verb{foo(} or \verb{pkg::foo(}). For each candidate commit, it verifies
the call is present somewhere in the repository tree at that commit using
\verb{git grep}.
}
\details{
Unlike functions that track \emph{latest} state, this function is concerned only
with historical "firsts". Therefore, \strong{if a cached clone already exists, no
network fetch is performed}. The cached repository is assumed to contain a
complete history.

If the cached clone is detected to be shallow or invalid, it is deleted and
recloned to ensure correctness.

The return value is either the commit date (when \code{date_only = TRUE}) or a
one-row \code{data.frame} with commit metadata and a GitHub URL.

This function emits diagnostic \code{message()} output when it cannot determine an
answer (e.g., repository not found/inaccessible, checkout failed, git errors)
or when \code{fname} is never called under \code{dir}.

Candidate commits are obtained with \verb{git log --reverse -G <regex>} under
\code{dir}, using patterns that match \code{fname} calls like:
\itemize{
\item \verb{fname[[:space:]]*\\\\(}
\item \verb{::fname[[:space:]]*\\\\(}
}
Each candidate is then validated by searching the repository \emph{tree} at that
commit with \verb{git grep -E} for the same call-like pattern.

This function shares the same on-disk Git clone cache as
\code{get_first_commit()} via the \code{ggext.git_cache} option. Repositories
cloned by either function are reused by the other.

For best performance across sessions, set a persistent cache location:
\preformatted{
options(ggext.git_cache = "~/Library/Caches/ggext_git")
}
}
